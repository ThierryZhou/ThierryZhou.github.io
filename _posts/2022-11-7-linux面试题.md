---
title:  "linux内核面试题"
date:   2022-11-7 11:00
tag:    interview
author_profile: false
---

## 
##### 1. Linux 的体系结构

从大的方面讲，Linux 体系结构可以分为两块：  
![linux-stack](  /assets/image/posts/linux-stack.png)  
用户空间(User Space) ：用户空间又包括用户的应用程序(User Applications)、C 库(C Library) 。  
内核空间(Kernel Space) ：内核空间又包括系统调用接口(System Call Interface)、内核(Kernel)、平台架构相关的代码(Architecture-Dependent Kernel Code) 。

#### 2. Linux Inode

Linux 通过 inode 节点表将文件的逻辑结构和物理结构进行转换。

inode 节点是一个 64 字节长的表，表中包含了文件的相关信息，其中有文件的大小、文件所有者、文件的存取许可方式以及文件的类型等重要信息。在 inode 节点表中最重要的内容是磁盘地址表。在磁盘地址表中有 13 个块号，文件将以块号在磁盘地址表中出现的顺序依次读取相应的块。
Linux 文件系统通过把 inode 节点和文件名进行连接，当需要读取该文件时，文件系统在当前目录表中查找该文件名对应的项，由此得到该文件相对应的 inode 节点号，通过该 inode 节点的磁盘地址表把分散存放的文件物理块连接成文件的逻辑结构。

#### 3. 什么是硬链接和软链接？

硬链接：由于 Linux 下的文件是通过索引节点(inode)来识别文件，硬链接可以认为是一个指针，指向文件索引节点的指针，系统并不为它重新分配 inode 。每添加一个一个硬链接，文件的链接数就加 1 。

软链接：软链接克服了硬链接的不足，没有任何文件系统的限制，任何用户可以创建指向目录的符号链接。因而现在更为广泛使用，它具有更大的灵活性，甚至可以跨越不同机器、不同网络对文件进行链接。

不足：因为链接文件包含有原文件的路径信息，所以当原文件从一个目录下移到其他目录中，再访问链接文件，系统就找不到了，而硬链接就没有这个缺陷，你想怎么移就怎么移；还有它要系统分配额外的空间用于建立新的索引节点和保存原文件的路径。

#### 4. 主要有哪几种内核锁？Linux 内核的同步机制是什么？

自旋锁：spin_lock 忙等，中断中使用  
信号量：semxxx down/up write/read  
mutex：初始化为1的信号量  
读写锁，RCU(read-copy update)

#### 5. Linux 中的用户模式和内核模式是什么含义？
cpu mode，用户模式只能通过系统调用操作硬件资源，内核模式可以直接操作硬件资源

#### 6. 怎么申请大块内存？malloc、vmalloc 和 kmalloc 有什么区别？
malloc 用户空间下的内存管理接口。stack 和 heap 中间。小于128M的通过brk申请，大于的通过 mmap 申请。

vmalloc 用于申请大块内存，虚拟地址连续，物理地址不一定连续，不能直接用于DMA，在进程地址空间有专门的一块。对应释放函数 vfree()。

kmalloc 用于申请小内存，由 slab 管理实现，一般至少小于4KB（page）。不能申请大于128K的数据。物理地址和虚拟地址都连续，可用于DMA操作。

#### 7. 进程间通信主要有哪几种方式？

管道：两个进程需要有共同的祖先，pipe/popen  
命名管道：两个进程可以无关  
信号  
消息队列  
共享内存  
信号量  
套接字

#### 8. 伙伴系统申请内存的函数有哪些？
alloc_page(gfp_mask, order)

__get_free_pages(gfp_mask, order)

#### 9. 通过 slab 分配器申请内存的函数有哪些？
自己构造对象：kmem_cache_create/kmem_cache_alloc

普通匿名内存申请：kmalloc

#### 10. Linux 的内核空间和用户空间如何划分的？进程地址空间布局图？

32位可配置3G/1G, 2G/2G，一般是两级页表

64位可配置几级页表，一般可选3级/4级页表，256G/256G，或512T/512T


#### 11. 在支持并使能 MMU 的系统中，Linux 内核和用于程序分别运行在物理地址模式还是虚拟地址模式？
都运行在虚拟地址模式，页表转换对应由硬件单元MMU完成。

#### 12. Linux虚拟文件系统结构

super_block超级块

inode索引节点

dentry目录项

file文件

#### 13. Linux 中的文件包括哪些？
可执行文件，普通文件，目录文件，链接文件，设备文件，管道文件

#### 14. 创建进程的系统调用有哪些？
clone, fork, vfork

#### 15. 调用 schedule() 进行进程切换的方式有几种？
do_fork/do_timer/wake_up_process/setscheduler/sys_sched_yield

#### 16. Linux 调度程序是根据进程的动态优先级还是静态优先级来调度进程的？
cfs 会计算虚拟时间，还有一个计算出来的优先级。

#### 17.  TLB 中缓存的是什么内容

translation lookaside buffer, 也叫快表，用作页表缓冲。记录虚拟地址和物理地址的对应关系，用于加快地址转换。

#### 18. Linux 中有哪几种设备？

字符设备和块设备

#### 19. 设备驱动程序包括哪些功能函数？

open/read/write/ioctl/release/llseek

##### 20. 如何唯一标识一个设备？

主设备号和次设备号。dev_t，12位表示主设备号，20位表示次设备号。

MKDEV(int major, int minor)用于生产一个 dev_t 类型的对象。

#### 21. Linux 通过什么方式实现系统调用？

软件中断。系统调用编号，异常处理程序

#### 22. Linux 软中断和工作队列的作用是什么？

软中断：不可睡眠阻塞，处于中断上下文，不能进程切换，不能被自己打断。

工作队列：处理进程上下文中，可以睡眠阻塞。

## 更多技术分享浏览我的博客：  
https://thierryzhou.github.io